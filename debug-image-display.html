<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Image Display Issue</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .debug-section { 
            background: white; 
            margin: 20px 0; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .error { color: #dc3545; background: #f8d7da; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .success { color: #155724; background: #d4edda; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .warning { color: #856404; background: #fff3cd; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .code { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 4px; 
            font-family: monospace; 
            white-space: pre-wrap;
            border-left: 4px solid #007bff;
        }
        .url-test {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .url-test img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            margin-right: 15px;
            border: 1px solid #ccc;
        }
        .btn { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 15px; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px;
        }
        .btn:hover { background: #0056b3; }
        .btn.danger { background: #dc3545; }
        .btn.danger:hover { background: #c82333; }
    </style>
</head>
<body>
    <h1>üîç Debug Image Display Issue</h1>
    <p>Ki·ªÉm tra t·∫°i sao ·∫£nh kh√¥ng hi·ªÉn th·ªã trong web app (XPath: //*[@id="root"]/div[1]/div[2]/div[2]/div[2]/div[3]/div[3]/div[1]/div[1]/img)</p>

    <div class="debug-section">
        <h2>üéØ B∆∞·ªõc 1: Ki·ªÉm tra Web App</h2>
        <button class="btn" onclick="inspectWebApp()">üîç Inspect Web App</button>
        <button class="btn" onclick="testFabricAPI()">üì° Test Fabric API</button>
        <button class="btn danger" onclick="clearCache()">üóëÔ∏è Clear Cache</button>
        <div id="webapp-results"></div>
    </div>

    <div class="debug-section">
        <h2>‚òÅÔ∏è B∆∞·ªõc 2: Test Cloudinary URLs Tr·ª±c Ti·∫øp</h2>
        <div id="url-tests"></div>
    </div>

    <div class="debug-section">
        <h2>üêõ B∆∞·ªõc 3: Debug Console</h2>
        <div id="console-output" class="code"></div>
    </div>

    <script>
        const fabricCodes = [
            'AR-071-02B',
            'BERTONE-30', 
            'TP01623-224',
            'DCR-RP1120',
            '71022-10'
        ]

        function log(message, type = 'info') {
            const consoleDiv = document.getElementById('console-output')
            const timestamp = new Date().toLocaleTimeString()
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è'
            consoleDiv.innerHTML += `[${timestamp}] ${prefix} ${message}\n`
            consoleDiv.scrollTop = consoleDiv.scrollHeight
            console.log(`[DEBUG] ${message}`)
        }

        async function inspectWebApp() {
            const resultsDiv = document.getElementById('webapp-results')
            resultsDiv.innerHTML = '<div style="color: #666;">ƒêang ki·ªÉm tra web app...</div>'
            
            log('B·∫Øt ƒë·∫ßu ki·ªÉm tra web app...')
            
            try {
                // Test web app connection
                const response = await fetch('http://localhost:3001')
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`)
                }
                
                const html = await response.text()
                log(`Web app response OK: ${response.status}`, 'success')
                
                // Parse HTML to check for common issues
                const hasRoot = html.includes('id="root"')
                const hasReact = html.includes('react') || html.includes('React')
                const hasCloudinary = html.includes('cloudinary')
                const hasFabric = html.includes('fabric') || html.includes('Fabric')
                
                let diagnostics = `
                    <div class="success">‚úÖ Web app ƒëang ch·∫°y</div>
                    <p><strong>Response Status:</strong> ${response.status}</p>
                    <p><strong>Content Length:</strong> ${html.length} chars</p>
                    <p><strong>Has Root Element:</strong> ${hasRoot ? '‚úÖ' : '‚ùå'}</p>
                    <p><strong>React Detected:</strong> ${hasReact ? '‚úÖ' : '‚ùå'}</p>
                    <p><strong>Cloudinary References:</strong> ${hasCloudinary ? '‚úÖ' : '‚ùå'}</p>
                    <p><strong>Fabric References:</strong> ${hasFabric ? '‚úÖ' : '‚ùå'}</p>
                `
                
                // Check if it's loading page or error page
                if (html.includes('Loading') || html.includes('loading')) {
                    diagnostics += '<div class="warning">‚ö†Ô∏è App c√≥ th·ªÉ ƒëang trong tr·∫°ng th√°i loading</div>'
                }
                
                if (html.includes('Error') || html.includes('error')) {
                    diagnostics += '<div class="error">‚ùå C√≥ l·ªói trong app</div>'
                }
                
                resultsDiv.innerHTML = diagnostics
                log('Web app inspection completed', 'success')
                
                // Auto-open web app in new tab for manual inspection
                setTimeout(() => {
                    window.open('http://localhost:3001', '_blank')
                    log('M·ªü web app trong tab m·ªõi ƒë·ªÉ ki·ªÉm tra th·ªß c√¥ng')
                }, 1000)
                
            } catch (error) {
                log(`Web app connection failed: ${error.message}`, 'error')
                resultsDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn web app<br>
                        <strong>Error:</strong> ${error.message}<br>
                        <strong>Solution:</strong> Ch·∫°y <code>npm run dev</code> trong terminal
                    </div>
                `
            }
        }

        async function testFabricAPI() {
            log('Testing Fabric API calls...')
            
            try {
                // This would be the actual API call the web app makes
                // Since we can't directly call the internal API, we'll test Cloudinary URLs
                const testUrl = 'https://res.cloudinary.com/dgaktc3fb/image/upload/fabrics/AR-071-02B.jpg'
                const response = await fetch(testUrl, { method: 'HEAD' })
                
                if (response.ok) {
                    log(`Sample Cloudinary URL works: ${testUrl}`, 'success')
                } else {
                    log(`Sample Cloudinary URL failed: ${response.status}`, 'error')
                }
                
            } catch (error) {
                log(`API test failed: ${error.message}`, 'error')
            }
        }

        function clearCache() {
            // Clear localStorage
            localStorage.clear()
            log('localStorage cleared')
            
            // Clear sessionStorage  
            sessionStorage.clear()
            log('sessionStorage cleared')
            
            // Reload web app
            fetch('http://localhost:3001', { cache: 'no-cache' })
                .then(() => log('Web app cache refresh requested', 'success'))
                .catch(() => log('Failed to refresh web app cache', 'error'))
        }

        function createUrlTests() {
            const urlTestsDiv = document.getElementById('url-tests')
            let html = '<h3>Test Cloudinary URLs tr·ª±c ti·∫øp:</h3>'
            
            fabricCodes.forEach(code => {
                const url = `https://res.cloudinary.com/dgaktc3fb/image/upload/fabrics/${code}.jpg`
                html += `
                    <div class="url-test">
                        <img src="${url}" 
                             onload="logImageSuccess('${code}')"
                             onerror="logImageError('${code}')"
                             alt="${code}">
                        <div>
                            <strong>${code}</strong><br>
                            <small style="color: #666; word-break: break-all;">${url}</small><br>
                            <span id="status-${code}" style="color: #999;">Loading...</span>
                        </div>
                    </div>
                `
            })
            
            urlTestsDiv.innerHTML = html
            log('Created direct URL tests')
        }

        function logImageSuccess(code) {
            document.getElementById(`status-${code}`).innerHTML = '<span style="color: green;">‚úÖ Loaded</span>'
            log(`Image loaded successfully: ${code}`, 'success')
        }

        function logImageError(code) {
            document.getElementById(`status-${code}`).innerHTML = '<span style="color: red;">‚ùå Failed</span>'
            log(`Image failed to load: ${code}`, 'error')
        }

        // Initialize
        window.onload = function() {
            log('Debug page loaded')
            createUrlTests()
            
            // Auto-run basic checks
            setTimeout(inspectWebApp, 1000)
            setTimeout(testFabricAPI, 2000)
        }

        // Capture console errors
        window.addEventListener('error', function(e) {
            log(`JavaScript Error: ${e.message} at ${e.filename}:${e.lineno}`, 'error')
        })

        // Instructions for manual debugging
        log('üîß H∆Ø·ªöNG D·∫™N DEBUG TH·ª¶ C√îNG:')
        log('1. M·ªü DevTools trong web app (F12)')
        log('2. V√†o tab Console ƒë·ªÉ xem l·ªói JavaScript')  
        log('3. V√†o tab Network ƒë·ªÉ xem request ·∫£nh')
        log('4. Inspect element img ƒë·ªÉ xem src attribute')
        log('5. Ki·ªÉm tra trong tab Elements xem img tag c√≥ ƒë√∫ng kh√¥ng')
    </script>
</body>
</html>